<html>
<head>
   <script type="text/javascript">
     View = function(){};
   </script>
   <script type="text/javascript" src="jquery-1.6.1.min.js"></script>
   <script type="text/javascript" src="jsonFormat.js"></script>
   <script type="text/javascript" src="view/i18n/view_i18n.js"></script>
   <script type="text/javascript">
     var currentLanguage = "";  // language that is currently being translated
     var defaultLocaleMappings;
     /**
 *  retrieve i18n file based on VLE config. 
 *  first retrieves default locale and then retrieves user's locale.
 */
View.prototype.retrieveAllLocales = function() {
		for (var i=0; i < View.prototype.i18n.supportedLocales.length; i++) {
			var locale = View.prototype.i18n.supportedLocales[i];
				View.prototype.i18n[locale] = {};
				this.retrieveLocale(locale);
		};

}; 

     // given local (e.g. "ja"), returns language (e.g. "Japanese")
     function localeToLanguage(locale) {
       if (locale == "ja") {
         return "Japanese";
       } else if (locale == "zh_TW") {
         return "Traditional Chinese";
       } else if (locale == "zh_CN") {
         return "Simplified Chinese";
       } else if (locale == "ko") {
         return "Korean";
       }
     }
 
     // opens up the translated json file in a new window
     function showTranslation() {
       var translationFormattedJSONString = FormatJSON(View.prototype.i18n[currentLanguage]);       
       var message = "<h1>Translated text</h1><p>Follow these steps next:</p>" +
         "<ol><li>Copy the entire text below and save it inside WISE-Translate/vle/view/i18n/i18n_"+currentLanguage+".json file.</li>"+
             "<li>Open up the GitHub application. Your changes should show up as uncommited changes. Commit your changes to the repository.</li>"+
             "<li>Pat yourself on the back for a job well-done! Thanks for helping out!</li></ul><br/>";
       myWindow=window.open('Translation','','width=800,height=600');
       myWindow.document.write(message+"<textarea cols='75' rows='30'>"+translationFormattedJSONString+"</textarea>");
       myWindow.focus();
     }

     function onlyShowMissingTranslation() {
       if($("#onlyShowMissingTranslationInput:checked").length == 1) {
         $("tr textarea:not(:empty)").parents(".translationRow").hide();
       } else {
         $("tr textarea:not(:empty)").parents(".translationRow").show();
       }
     }

     function buildTable() {
         var translationTable = 
				"<p><b>Remember to save your work before closing this window by clicking on the \"Show Translation File\".</b></p><div style='display:block; margin:10px 0px'><input id='onlyShowMissingTranslationInput' onClick='onlyShowMissingTranslation()' type='checkbox'></input>Only Show Missing Translations&nbsp;&nbsp;&nbsp;" +
				"<input id='showTranslationInput' type='button' onClick='showTranslation()' value='Show Translation File'></input></div>" +
				"<table border='1'>";
         // build the header row
         translationTable += "<tr><th>key</th><th>description</th><th>"+View.prototype.i18n.defaultLocale+"</th>";
       	 translationTable += "<th>"+currentLanguage+"</th>";
         translationTable += "</tr>\n\n";

         // build the rest of the table
         if (currentLanguage != "") {        
         for (key in defaultLocaleMappings) {
           var obj = defaultLocaleMappings[key];
	   translationTable += "<tr class='translationRow'>\n<td>"+key+"</td>\n<td>"+obj.description+"</td>\n<td>"+obj.value+"</td>\n";
           if (View.prototype.i18n[currentLanguage][key]) {
	     translationTable += "<td><textarea style='height:100%;width:100%' id='"+key+"'>"+View.prototype.i18n[currentLanguage][key].value+"</textarea></td>\n";
	   } else {
	     translationTable += "<td><textarea style='height:100%;width:100%' id='"+key+"'></textarea></td>\n";
	   }
	   translationTable += "</tr>\n\n";                      
         }
         }
         translationTable += "</table>";
         $("#translationTableDiv").html(translationTable);
         $("textarea").change(function() {
           var key = this.id;
           var value = $(this).val();
           console.log(value);
           console.log(currentLanguage);
           console.log(key);
           if (!View.prototype.i18n[currentLanguage][key]) {
             View.prototype.i18n[currentLanguage][key] = {};
           }
           View.prototype.i18n[currentLanguage][key].value = value;
           View.prototype.i18n[currentLanguage][key].description = View.prototype.i18n[View.prototype.i18n.defaultLocale][key].description;
         });
     }


     $(document).ready(function() {  

         // add supported locales to selectable drop-down list
         for (var i=0; i<View.prototype.i18n.supportedLocales.length; i++) { 
           var supportedLocale = View.prototype.i18n.supportedLocales[i];
           if (supportedLocale != "en_US") {
             $("#currentLanguageSelect").append("<option id='"+supportedLocale+"' value='"+supportedLocale+"'>"+localeToLanguage(supportedLocale)+" ("+supportedLocale+") "+"</option");
           }
         }
         var thisView = new View();
         // print default and supported locales
         $("#defaultLocale").append(View.prototype.i18n.defaultLocale);
         thisView.retrieveAllLocales();

         defaultLocaleMappings = View.prototype.i18n[View.prototype.i18n.defaultLocale];
          
        $("#currentLanguageSelect option").click(function() {
        // user changed currentLanguage
          currentLanguage = $(this).val();
          buildTable();
        });
      }); 
   </script>
   <style>
   td {
      width:250px;
      word-wrap:break-word;
   }
   </style>
</head>
<body>
<h1>WISE Translate: VLE</h1>
<p>Thank you for being part of the WISE Translation Community! Please post bug reports and questions to the <a target="_blank" href="https://groups.google.com/forum/?pli=1#!forum/wise4-dev">WISE4-dev Googlegroup</a>.</p>
<div id="defaultLocale">Default Locale: </div>
<div id="currentLanguage">Currently Translating: 
<select id="currentLanguageSelect">
<option>Choose a language...</option>
</select>
</div>

<div id="translationTableDiv">
</div>
</body>
</html>
